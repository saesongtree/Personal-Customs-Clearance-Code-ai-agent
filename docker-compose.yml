version: '3.8'

services:
  # 1. Elasticsearch 서비스 정의
  elasticsearch:
    build: ./elasticsearch  # ./elasticsearch 폴더의 Dockerfile로 이미지를 빌드
    container_name: es-rag-container
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m" # 메모리 할당 (필요에 따라 조절)
    ports:
      - "9200:9200"
    volumes:
      - esdata:/usr/share/elasticsearch/data # 데이터를 영구적으로 보관하기 위한 볼륨

  # 2. 파이썬 앱 서비스 정의
  app:
    build: ./app  # ./app 폴더의 Dockerfile로 이미지를 빌드
    environment:
      # 파이썬 코드에서 사용할 Elasticsearch 주소
      - ELASTICSEARCH_HOST=http://elasticsearch:9200
    depends_on:
      - elasticsearch # Elasticsearch가 먼저 실행된 후에 app을 실행

volumes:
  esdata: # 위에서 사용한 볼륨 정의